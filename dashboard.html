<style>
    /* General Resets and Typography */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f7f6;
    color: #333;
}

/* Header Styling */
header {
    background-color: #1a5632; /* Deep green, reflecting Alkhidmat's branding */
    color: white;
    padding: 15px 50px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.logo {
    font-size: 1.5em;
    font-weight: bold;
}

nav a {
    color: white;
    text-decoration: none;
    margin-left: 25px;
    padding: 5px 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
}

nav a:hover, nav a.active {
    background-color: #2b7049;
}



/* --- Styles Specific to User Dashboard (Page 5) --- */

/* Layout: Sidebar on Left, Content on Right */
.dashboard-layout {
    display: flex;
    gap: 30px;
    margin-top: 20px;
}

/* Sidebar Styling */
.profile-sidebar {
    flex-basis: 300px;
    flex-shrink: 0;
}

.profile-card {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    text-align: center;
}

.avatar-circle {
    width: 80px;
    height: 80px;
    background-color: #1a5632;
    color: white;
    font-size: 2.5em;
    font-weight: bold;
    border-radius: 50%;
    line-height: 80px;
    margin: 0 auto 15px;
}

.profile-header h3 {
    margin: 0;
    color: #333;
}

.profile-header p {
    color: #777;
    font-size: 0.9em;
    margin-top: 5px;
}

/* Profile Form Styling */
.profile-form {
    text-align: left;
    margin-top: 20px;
    border-top: 1px solid #eee;
    padding-top: 20px;
}

.profile-form label {
    display: block;
    font-size: 0.85em;
    color: #555;
    margin-bottom: 5px;
    margin-top: 15px;
}

.profile-form input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 5px;
}

.full-width {
    width: 100%;
    margin-top: 15px;
}

/* Right Content Area */
.history-section {
    flex-grow: 1;
}

/* Impact Summary Boxes */
.impact-summary {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.impact-box {
    background: #1a5632; /* Alkhidmat Green */
    color: white;
    padding: 20px;
    border-radius: 8px;
    flex: 1;
    text-align: center;
}

.impact-box p {
    margin: 0;
    font-size: 0.9em;
    opacity: 0.9;
}

.impact-box h3 {
    margin: 5px 0 0;
    font-size: 1.8em;
}

/* History Table Specifics */
.history-table {
    width: 100%;
    background: white;
    border-collapse: collapse;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
}

.history-table th {
    background-color: #f4f4f4;
    padding: 15px;
    text-align: left;
    font-size: 0.9em;
    color: #555;
}

.history-table td {
    padding: 15px;
    border-bottom: 1px solid #eee;
}

.receipt-link {
    color: #2196F3;
    text-decoration: none;
    font-weight: bold;
    font-size: 0.9em;
}

/* Volunteer Status Box */
.volunteer-status-card {
    margin-top: 30px;
    background: #fff3e0; /* Light Orange bg */
    border: 1px solid #ffe0b2;
    padding: 20px;
    border-radius: 8px;
}

.volunteer-status-card h3 {
    margin-top: 0;
    color: #e65100;
}

.secondary-btn {
    background-color: #fff;
    color: #e65100;
    border: 1px solid #e65100;
    margin-top: 10px;
}

.secondary-btn:hover {
    background-color: #e65100;
    color: white;
}

/* --- Styles Specific to Feedback Card Integration --- */

.feedback-card {
    margin-top: 30px;
    background: #e3f2fd; /* Light blue background for emphasis */
    border: 1px solid #bbdefb;
    padding: 25px;
    border-radius: 8px;
}

.feedback-card h3 {
    margin-top: 0;
    color: #1565c0; /* Darker blue heading */
}

.feedback-card p {
    font-size: 0.9em;
    color: #555;
    margin-bottom: 20px;
}

.feedback-card .form-group {
    margin-bottom: 15px;
}

.feedback-card label {
    font-weight: bold;
    color: #333;
    display: block;
    margin-bottom: 5px;
}

.feedback-card select,
.feedback-card input[type="number"],
.feedback-card textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}

/* Adjusting the rating input size */
.feedback-card .rating-group input[type="number"] {
    width: 80px;
    text-align: center;
}

.feedback-btn {
    background-color: #1565c0; /* Blue button */
    color: white;
    width: 100%;
    padding: 12px;
    font-weight: bold;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.feedback-btn:hover {
    background-color: #0d47a1;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .dashboard-layout {
        flex-direction: column;
    }
    
    .profile-sidebar {
        flex-basis: auto;
    }
}
</style>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - Alkhidmat</title>
    
    <script defer src="dashboard.js"></script>
</head>
<body>

    <header>
        <div class="logo">Alkhidmat Donor Portal</div>
        <nav>
            <a href="index.html">Browse Causes</a>
            <a href="dashboard.html" class="active">My Dashboard</a>
            <a href="index.html" class="logout-link">Logout</a>
        </nav>
    </header>

    <main class="container">
        <h1>Welcome back, <span id="user-name">Jawad</span>!</h1>

        <div class="dashboard-layout">
            
            <aside class="profile-sidebar">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="avatar-circle" id="avatar-initial">J</div>
                        <h3 id="profile-name">Jawad Ahmad</h3>
                        <p>Donor Account</p>
                    </div>
                    
                    <form action="/update_profile" method="POST" class="profile-form">
                        <label>Full Name</label>
                        <input type="text" name="name" id="profile-full-name" required>
                        
                        <label>Email Address</label>
                        <input type="email" name="email" id="profile-email" readonly> 
                        
                        <label>New Password</label>
                        <input type="password" name="password" placeholder="Leave blank to keep current">
                        
                        <button type="submit" class="action-btn edit-btn full-width">Update Profile</button>
                    </form>
                </div>
            </aside>

            <section class="history-section">
                
                <div class="impact-summary">
                    <div class="impact-box">
                        <p>Total Donated</p>
                        <h3 id="total-donated-stat">PKR 15,000</h3>
                    </div>
                    <div class="impact-box">
                        <p>Causes Supported</p>
                        <h3 id="causes-supported-stat">3</h3>
                    </div>
                </div>

                <h2>üìú My Donation History</h2>
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Cause Title</th> 
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Receipt</th>
                            </tr>
                        </thead>
                        <tbody id="donation-history-body">
                            </tbody>
                    </table>
                </div>

                <div class="volunteer-status-card">
                    <h3>ü§ù Become a Volunteer</h3>
                    <p>Register your skills and availability to contribute your time to Alkhidmat's causes.</p>
                    
                    <form action="/register_volunteer" method="POST">
                        <div class="form-group">
                            <label for="volunteer-skills">Skills (e.g., Medical, Teaching, Driving)</label>
                            <input type="text" id="volunteer-skills" name="skills" 
                                   placeholder="List your skills, separated by commas" required>
                        </div>

                        <div class="form-group">
                            <label for="volunteer-ngo">Select Primary NGO to Help</label>
                            <select id="volunteer-ngo" name="ngo_id" required>
                                <option value="">--- Loading NGOs... ---</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="volunteer-availability">Availability</label>
                            <select id="volunteer-availability" name="availability" required>
                                <option value="Weekend">Weekends Only</option>
                                <option value="Weekday">Weekdays (Part-time)</option>
                                <option value="FullTime">Full Time (Temporary)</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="action-btn secondary-btn full-width">Register Me as Volunteer</button>
                    </form>
                </div>

                <div class="feedback-card">
                    <h3>‚≠ê Submit Feedback on an NGO</h3>
                    <p>Help us ensure transparency and quality by sharing your experience.</p>
                    <form action="/submit_feedback" method="POST">
                        <div class="form-group">
                            <label for="feedback-ngo">Select NGO</label>
                            <select id="feedback-ngo" name="ngo_id" required>
                                <option value="">--- Loading NGOs... ---</option>
                            </select>
                        </div>

                        <div class="form-group rating-group">
                            <label>Rating (1-5)</label>
                            <input type="number" id="feedback-rating" name="rating" min="1" max="5" value="5" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="feedback-message">Your Message</label>
                            <textarea id="feedback-message" name="message" rows="3" required></textarea>
                        </div>

                        <button type="submit" class="action-btn feedback-btn full-width">Send Feedback</button>
                    </form>
                </div>
            </section>
        </div>

    </main>

    <footer>
        <p>&copy; 2025 Smart Donation & NGO Management System</p>
    </footer>
<script>
// dashboard.js
document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem("authToken");
  if (!token) {
    alert("Please login first.");
    window.location.href = "login.html";
    return;
  }

  const authHeaders = { Authorization: `Bearer ${token}` };

  // Helper function to format currency
  const formatPKR = (amount) => `PKR ${Number(amount || 0).toLocaleString()}`;

  // --- 1. Fetch User Profile Data and Stats ---
  function fetchUserProfileAndStats() {
    fetch("http://localhost:3000/api/user/me", { headers: authHeaders })
      .then(async (res) => {
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      })
      .then((data) => {
        const firstName = (data.name || "User").split(" ")[0];

        document.getElementById("user-name").textContent = firstName;
        document.getElementById("avatar-initial").textContent = firstName.charAt(0).toUpperCase();
        document.getElementById("profile-name").textContent = data.name || "";

        document.getElementById("profile-full-name").value = data.name || "";
        document.getElementById("profile-email").value = data.email || "";

        document.getElementById("total-donated-stat").textContent = formatPKR(data.totalDonated);
        document.getElementById("causes-supported-stat").textContent = data.causesSupported ?? 0;
      })
      .catch((err) => {
        console.error("Error fetching user data:", err);
        alert("Session expired. Please login again.");
        localStorage.removeItem("authToken");
        window.location.href = "login.html";
      });
  }

  // --- 2. Fetch Donation History ---
  function fetchDonationHistory() {
    fetch("http://localhost:3000/api/donations/history", { headers: authHeaders })
      .then(async (res) => {
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      })
      .then((history) => {
        const tableBody = document.getElementById("donation-history-body");
        tableBody.innerHTML = "";

        if (!history || history.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="5">You have no donation history yet.</td></tr>';
          return;
        }

        history.forEach((donation) => {
          const row = `
            <tr>
              <td>${new Date(donation.date).toLocaleDateString()}</td>
              <td><strong>${donation.causeTitle}</strong></td>
              <td>${formatPKR(donation.amount)}</td>
              <td>${donation.method}</td>
              <td><a href="http://localhost:3000/receipts/${donation.id}" class="receipt-link" target="_blank">View</a></td>
            </tr>
          `;
          tableBody.innerHTML += row;
        });
      })
      .catch((err) => console.error("Error fetching donation history:", err));
  }

  // --- 3. Fetch NGOs for Select Forms ---
  function fetchNGOs() {
    fetch("http://localhost:3000/api/ngos") // this endpoint can be public
      .then(async (res) => {
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      })
      .then((ngos) => {
        const volunteerSelect = document.getElementById("volunteer-ngo");
        const feedbackSelect = document.getElementById("feedback-ngo");

        volunteerSelect.innerHTML = "";
        feedbackSelect.innerHTML = '<option value="">--- Select an NGO ---</option>';

        ngos.forEach((ngo) => {
          const option = `<option value="${ngo.id}">${ngo.name}</option>`;
          volunteerSelect.innerHTML += option;
          feedbackSelect.innerHTML += option;
        });
      })
      .catch((err) => console.error("Error fetching NGOs:", err));
  }

  fetchUserProfileAndStats();
  fetchDonationHistory();
  fetchNGOs();
});
</script>

</body>
</html>