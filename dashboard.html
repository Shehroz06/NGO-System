<<<<<<< HEAD
<style>
    /* General Resets and Typography */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f7f6;
    color: #333;
}
=======
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donor Dashboard - Smart NGO System</title>
    <style>
        /* General Resets and Typography */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }
>>>>>>> 8a68def (Changes made)

        /* Header Styling */
        header {
            background-color: #1a5632;
            color: white;
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.5em;
            font-weight: bold;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        nav a:hover, nav a.active {
            background-color: #2b7049;
        }

        .donate-main-btn {
            background-color: #ff6347;
            color: white !important;
            font-weight: bold;
        }

        /* Layout: Sidebar on Left, Content on Right */
        .dashboard-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 280px;
            background-color: #fff;
            padding: 30px 20px;
            border-right: 1px solid #eee;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        }

        .sidebar h2 {
            color: #1a5632;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #f4f7f6;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li a {
            display: block;
            text-decoration: none;
            color: #555;
            padding: 12px 20px;
            margin-bottom: 8px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .sidebar-menu li a:hover {
            background-color: #e0f2e0;
            color: #1a5632;
        }

        .sidebar-menu li a.active-menu {
            background-color: #1a5632;
            color: white;
        }

        .dashboard-content {
            flex-grow: 1;
            padding: 40px 60px;
        }

        /* Dashboard Section Cards */
        .dashboard-section {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .dashboard-section h3 {
            color: #1a5632;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.4em;
            border-left: 5px solid #1a5632;
            padding-left: 15px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th {
            background-color: #f8f9fa;
            color: #666;
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid #eee;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .receipt-link {
            color: #ff6347;
            text-decoration: none;
            font-weight: bold;
        }

        /* Forms */
        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 15px;
        }

        .submit-btn {
            background-color: #1a5632;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.3s;
        }

        .submit-btn:hover { opacity: 0.9; }

<<<<<<< HEAD
.form-group input[type="text"],
.form-group input[type="email"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}

.submit-btn {
    background-color: #f4a261;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s;
}

.submit-btn:hover {
    background-color: #e76f51;
}

/* Utility */
.hidden {
    display: none;
}
</style>
=======
        .hidden { display: none; }
    </style>
>>>>>>> 8a68def (Changes made)
</head>
<body>

<header>
    <div class="logo">Smart NGO System</div>
    <nav id="top-nav">
        <a href="home.html">Causes</a>
        <a href="dashboard.html" class="active">My Dashboard</a>
        <a href="login.html" onclick="localStorage.clear()">Logout</a>
        <a href="donate.html" class="donate-main-btn">Donate Now</a>
    </nav>
</header>

<div class="dashboard-layout">
    <aside class="sidebar">
        <h2>User Account</h2>
        <ul class="sidebar-menu">
            <li><a href="#" class="active-menu" data-target="history">Donation History</a></li>
            <li><a href="#" data-target="volunteer">Volunteer Sign-up</a></li>
            <li><a href="#" data-target="feedback">Feedback & Complaints</a></li>
            <li><a href="login.html" onclick="localStorage.clear()">Logout</a></li>
        </ul>
    </aside>

    <main class="dashboard-content">
        <h1 id="welcome-msg">Welcome back!</h1>

        <section id="history" class="dashboard-section">
            <h3>Recent Contributions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Cause Title</th>
                        <th>Amount</th>
                        <th>Method</th>
                        <th>Receipt</th>
                    </tr>
                </thead>
                <tbody id="donation-history-body">
                    <tr><td colspan="5">Loading your history...</td></tr>
                </tbody>
            </table>
        </section>

        <section id="volunteer" class="dashboard-section hidden">
            <h3>Become a Volunteer</h3>
            <form id="volunteer-form">
                <div class="form-group">
<<<<<<< HEAD
                    <label for="volunteer-name">Full Name:</label>
                    <input type="text" id="volunteer-name" required>
                </div>
                <div class="form-group">
                    <label for="volunteer-email">Email:</label>
                    <input type="email" id="volunteer-email" required>
                </div>
<<<<<<< HEAD
                <div class="form-group">
                    <label for="volunteer-skill">Skills (e.g., IT, Management):</label>
                    <input type="text" id="volunteer-skill" required>
                </div>
                <div class="form-group">
                    <label for="volunteer-ngo">Preferred NGO to Volunteer For:</label>
                    <select id="volunteer-ngo" required>
                        <option value="">--- Select an NGO ---</option>
                        </select>
=======

                <h2>My Donation History</h2>
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Cause Title</th> 
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Receipt</th>
                            </tr>
                        </thead>
                        <tbody id="donation-history-body">
                            </tbody>
                    </table>
                </div>

                <div class="volunteer-status-card">
                    <h3> Become a Volunteer</h3>
                    <p>Register your skills and availability to contribute your time to Alkhidmat's causes.</p>
                    
                    <form action="/register_volunteer" method="POST">
                        <div class="form-group">
                            <label for="volunteer-skills">Skills (e.g., Medical, Teaching, Driving)</label>
                            <input type="text" id="volunteer-skills" name="skills" 
                                   placeholder="List your skills, separated by commas" required>
                        </div>

                        <div class="form-group">
                            <label for="volunteer-ngo">Select Primary NGO to Help</label>
                            <select id="volunteer-ngo" name="ngo_id" required>
                                <option value="">--- Loading NGOs... ---</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="volunteer-availability">Availability</label>
                            <select id="volunteer-availability" name="availability" required>
                                <option value="Weekend">Weekends Only</option>
                                <option value="Weekday">Weekdays (Part-time)</option>
                                <option value="FullTime">Full Time (Temporary)</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="action-btn secondary-btn full-width">Register Me as Volunteer</button>
                    </form>
>>>>>>> 22d280a (Update html files)
                </div>
                <button type="submit" class="submit-btn">Submit Application</button>
                <p id="volunteer-status" style="margin-top: 15px; color: green;"></p>
=======
                    <label>Full Name</label>
                    <input type="text" id="vol-name" required>
                </div>
                <div class="form-group">
                    <label>Skills (e.g., Marketing, IT)</label>
                    <input type="text" id="vol-skill" placeholder="List skills separated by commas" required>
                </div>
                <div class="form-group">
                    <label>Preferred NGO</label>
                    <select id="vol-ngo" required>
                        <option value="">Select an Organization</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Availability</label>
                    <select id="vol-avail" required>
                        <option value="Weekend">Weekends Only</option>
                        <option value="Weekday">Weekdays</option>
                        <option value="FullTime">Full Time</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Submit Application</button>
                <p id="vol-status" style="margin-top:15px;"></p>
>>>>>>> 8a68def (Changes made)
            </form>
        </section>

<<<<<<< HEAD
        <section id="feedback" class="dashboard-section hidden">
<<<<<<< HEAD
            <h3>Submit Feedback / Complaint</h3>
            <form id="feedback-form">
                <div class="form-group">
                    <label for="feedback-ngo">Regarding NGO:</label>
                    <select id="feedback-ngo" required>
                        <option value="">--- Select an NGO ---</option>
                        </select>
=======
                <div class="feedback-card">
                    <h3> Submit Feedback on an NGO</h3>
                    <p>Help us ensure transparency and quality by sharing your experience.</p>
                    <form action="/submit_feedback" method="POST">
                        <div class="form-group">
                            <label for="feedback-ngo">Select NGO</label>
                            <select id="feedback-ngo" name="ngo_id" required>
                                <option value="">--- Loading NGOs... ---</option>
                            </select>
                        </div>

                        <div class="form-group rating-group">
                            <label>Rating (1-5)</label>
                            <input type="number" id="feedback-rating" name="rating" min="1" max="5" value="5" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="feedback-message">Your Message</label>
                            <textarea id="feedback-message" name="message" rows="3" required></textarea>
                        </div>

                        <button type="submit" class="action-btn feedback-btn full-width">Send Feedback</button>
                    </form>
>>>>>>> 22d280a (Update html files)
                </div>
                <div class="form-group">
                    <label for="feedback-type">Type:</label>
                    <select id="feedback-type" required>
=======
            <h3>Submit Feedback</h3>
            <form id="feedback-form">
                <div class="form-group">
                    <label>Target NGO</label>
                    <select id="feed-ngo" required>
                        <option value="">Select an Organization</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="feed-type" required>
>>>>>>> 8a68def (Changes made)
                        <option value="feedback">General Feedback</option>
                        <option value="complaint">Complaint</option>
                        <option value="suggestion">Suggestion</option>
                    </select>
                </div>
                <div class="form-group">
<<<<<<< HEAD
                    <label for="feedback-message">Message:</label>
                    <textarea id="feedback-message" rows="5" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Submit Feedback</button>
                <p id="feedback-status" style="margin-top: 15px; color: green;"></p>
=======
                    <label>Your Message</label>
                    <textarea id="feed-msg" rows="5" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Send Feedback</button>
                <p id="feed-status" style="margin-top:15px;"></p>
>>>>>>> 8a68def (Changes made)
            </form>
        </section>
    </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem("authToken");
    const role = localStorage.getItem("userRole");

    // 1. Session & RBAC Check
    if (!token) {
        window.location.href = "login.html";
        return;
    }

    // Update Top Nav for Staff
    if (role === 'ngo_staff') {
        const topNav = document.getElementById('top-nav');
        const logoutLink = topNav.querySelector('a[onclick*="localStorage.clear()"]');
        const adminLink = document.createElement('a');
        adminLink.href = 'admin.html';
        adminLink.textContent = 'Admin Panel';
        const reportsLink = document.createElement('a');
        reportsLink.href = 'reports.html';
        reportsLink.textContent = 'Reports';
        
        topNav.insertBefore(adminLink, logoutLink);
        topNav.insertBefore(reportsLink, logoutLink);
    }

    const authHeaders = {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
    };

    // 2. Sidebar Navigation
    const menuLinks = document.querySelectorAll(".sidebar-menu li a");
    const sections = document.querySelectorAll(".dashboard-section");

    menuLinks.forEach(link => {
        link.addEventListener("click", (e) => {
            const target = link.getAttribute("data-target");
            if (!target) return;
            e.preventDefault();

            sections.forEach(s => s.classList.add("hidden"));
            document.getElementById(target).classList.remove("hidden");

            menuLinks.forEach(l => l.classList.remove("active-menu"));
            link.classList.add("active-menu");
        });
    });

    // 3. Fetch Data: Donation History
    fetch("http://localhost:3000/api/donations/history", { headers: authHeaders })
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("donation-history-body");
            tbody.innerHTML = data.length ? "" : "<tr><td colspan='5'>No donations found.</td></tr>";
            
            data.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${new Date(item.date).toLocaleDateString()}</td>
                        <td><strong>${item.causeTitle}</strong></td>
                        <td>PKR ${item.amount.toLocaleString()}</td>
                        <td>${item.method}</td>
                        <td><a href="http://localhost:3000/receipts/${item.id}" class="receipt-link" target="_blank">View PDF</a></td>
                    </tr>
                `;
            });
        });

    // 4. Fetch NGOs for Forms
    fetch("http://localhost:3000/api/ngos")
        .then(res => res.json())
        .then(ngos => {
            const volSelect = document.getElementById("vol-ngo");
            const feedSelect = document.getElementById("feed-ngo");
            ngos.forEach(ngo => {
                const opt = `<option value="${ngo.id}">${ngo.name}</option>`;
                volSelect.innerHTML += opt;
                feedSelect.innerHTML += opt;
            });
        });

    // 5. Submit Volunteer Form
    document.getElementById('volunteer-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const body = {
            name: document.getElementById('vol-name').value,
            skill: document.getElementById('vol-skill').value,
            ngoId: document.getElementById('vol-ngo').value,
            availability: document.getElementById('vol-avail').value
        };

        const res = await fetch('http://localhost:3000/api/volunteer', {
            method: 'POST',
            headers: authHeaders,
            body: JSON.stringify(body)
        });

        const status = document.getElementById('vol-status');
        if (res.ok) {
            status.textContent = "Application submitted!";
            status.style.color = "green";
            e.target.reset();
        } else {
            status.textContent = "Submission failed.";
            status.style.color = "red";
        }
<<<<<<< HEAD

        history.forEach((donation) => {
          const row = `
            <tr>
              <td>${new Date(donation.date).toLocaleDateString()}</td>
              <td><strong>${donation.causeTitle}</strong></td>
              <td>${formatPKR(donation.amount)}</td>
              <td>${donation.method}</td>
              <td><a href="http://localhost:3000/receipts/${donation.id}" class="receipt-link" target="_blank">View</a></td>
            </tr>
          `;
          tableBody.innerHTML += row;
        });
      })
      .catch((err) => console.error("Error fetching donation history:", err));
  }

  // --- 3. Fetch NGOs for Select Forms ---
  function fetchNGOs() {
    fetch("http://localhost:3000/api/ngos") // this endpoint can be public
      .then(async (res) => {
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      })
      .then((ngos) => {
        const volunteerSelect = document.getElementById("volunteer-ngo");
        const feedbackSelect = document.getElementById("feedback-ngo");

        volunteerSelect.innerHTML = '<option value="">--- Select an NGO ---</option>';
        feedbackSelect.innerHTML = '<option value="">--- Select an NGO ---</option>';

        ngos.forEach((ngo) => {
          const option = `<option value="${ngo.id}">${ngo.name}</option>`;
          volunteerSelect.innerHTML += option;
          feedbackSelect.innerHTML += option;
        });
      })
      .catch((err) => console.error("Error fetching NGOs:", err));
  }
  
  // --- 4. Handle Volunteer Form Submission ---
  document.getElementById('volunteer-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('volunteer-name').value;
    const email = document.getElementById('volunteer-email').value;
    const skill = document.getElementById('volunteer-skill').value;
    const ngoId = document.getElementById('volunteer-ngo').value;
    const statusEl = document.getElementById('volunteer-status');

    statusEl.textContent = 'Submitting application...';
    statusEl.style.color = 'blue';

    fetch('http://localhost:3000/api/volunteer', {
      method: 'POST',
      headers: authHeaders,
      body: JSON.stringify({ name, email, skill, ngoId })
    })
    .then(async res => {
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    })
    .then(() => {
      statusEl.textContent = 'Volunteer application submitted successfully! We will contact you soon.';
      statusEl.style.color = 'green';
      document.getElementById('volunteer-form').reset();
    })
    .catch(err => {
      console.error(err);
      statusEl.textContent = 'Submission failed. Please try again.';
      statusEl.style.color = 'red';
    });
  });

  // --- 5. Handle Feedback Form Submission ---
  document.getElementById('feedback-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const ngoId = document.getElementById('feedback-ngo').value;
    const type = document.getElementById('feedback-type').value;
    const message = document.getElementById('feedback-message').value;
    const statusEl = document.getElementById('feedback-status');

    statusEl.textContent = 'Submitting feedback...';
    statusEl.style.color = 'blue';

    fetch('http://localhost:3000/api/feedback', {
      method: 'POST',
      headers: authHeaders,
      body: JSON.stringify({ ngoId, type, message })
    })
    .then(async res => {
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    })
    .then(() => {
      statusEl.textContent = 'Feedback submitted successfully. Thank you for your input.';
      statusEl.style.color = 'green';
      document.getElementById('feedback-form').reset();
    })
    .catch(err => {
      console.error(err);
      statusEl.textContent = 'Submission failed. Please try again.';
      statusEl.style.color = 'red';
    });
  });

  // Initial data loads
  fetchDonationHistory();
  fetchNGOs();
=======
    });
>>>>>>> 8a68def (Changes made)
});
</script>
</body>
</html>